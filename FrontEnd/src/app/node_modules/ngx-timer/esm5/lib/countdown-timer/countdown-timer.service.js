/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, EventEmitter } from '@angular/core';
import { Observable, interval } from 'rxjs';
import { TimerStaus } from './countdown-timer.model';
import * as i0 from "@angular/core";
var CountdownTimerService = /** @class */ (function () {
    function CountdownTimerService() {
        var _this = this;
        this.onTimerStatusChange = new EventEmitter();
        //Init
        this.timerValue = {
            seconds: '00',
            mins: '00',
            hours: '00',
        };
        this.isTimerStart = false;
        this.totalSeconds = 0;
        this.currentOperationId = 0;
        //start timer
        this.startTimer = (/**
         * @param {?} startTime
         * @return {?}
         */
        function (startTime) {
            if (startTime) {
                /** @type {?} */
                var currentDate = new Date();
                /** @type {?} */
                var startedTime = new Date(startTime);
                _this.totalSeconds = (Math.round((currentDate.getTime() - startedTime.getTime()) / 1000)) * -1;
            }
            _this.isTimerStart = true;
            _this.onTimerStatusChange.emit(TimerStaus.START);
            return true;
        });
        //end timer
        this.pauseTimer = (/**
         * @param {?=} startTime
         * @param {?=} endTime
         * @return {?}
         */
        function (startTime, endTime) {
            if (startTime && endTime) {
                /** @type {?} */
                var endedDate = new Date(endTime);
                /** @type {?} */
                var startedTime = new Date(startTime);
                _this.totalSeconds = Math.round((endedDate.getTime() - startedTime.getTime()) / 1000);
            }
            _this.isTimerStart = false;
            _this.onTimerStatusChange.emit(TimerStaus.PAUSE);
            return false;
        });
        //reset Timer
        this.stopTimer = (/**
         * @return {?}
         */
        function () {
            _this.isTimerStart = false;
            _this.totalSeconds = 0;
            _this.onTimerStatusChange.emit(TimerStaus.STOP);
        });
        //resume Timer
        this.resumeTimer = (/**
         * @return {?}
         */
        function () {
            _this.isTimerStart = true;
        });
        //get timer value Obj
        this.getTimerValue = (/**
         * @return {?}
         */
        function () {
            return new Observable((/**
             * @param {?} obs
             * @return {?}
             */
            function (obs) {
                if (_this.intervalSubscription) {
                    _this.intervalSubscription.unsubscribe();
                }
                _this.intervalSubscription = _this.interval.subscribe((/**
                 * @param {?} int
                 * @return {?}
                 */
                function (int) {
                    if (_this.isTimerStart && _this.totalSeconds > 0) {
                        --_this.totalSeconds;
                        _this.timerValue.seconds = _this.setTimervalue(_this.totalSeconds % 60);
                        /** @type {?} */
                        var totalSecondsForMinutes = 0;
                        totalSecondsForMinutes = (Math.trunc(_this.totalSeconds / 60) >= 60) ? (_this.totalSeconds / 60) % 60 : _this.totalSeconds / 60;
                        _this.timerValue.mins = _this.setTimervalue(Math.trunc(totalSecondsForMinutes));
                        _this.timerValue.hours = _this.setTimervalue(Math.trunc(_this.totalSeconds / 3600));
                        obs.next(_this.timerValue);
                        obs.complete();
                    }
                    else {
                        if (_this.totalSeconds > 0) {
                            _this.timerValue.seconds = _this.setTimervalue(_this.totalSeconds % 60);
                            /** @type {?} */
                            var totalSecondsForMinutes = 0;
                            totalSecondsForMinutes = (Math.trunc(_this.totalSeconds / 60) >= 60) ? (_this.totalSeconds / 60) % 60 : _this.totalSeconds / 60;
                            _this.timerValue.mins = _this.setTimervalue(Math.trunc(totalSecondsForMinutes));
                            _this.timerValue.hours = _this.setTimervalue(Math.trunc(_this.totalSeconds / 3600));
                        }
                        else {
                            _this.timerValue.hours = "00";
                            _this.timerValue.mins = "00";
                            _this.timerValue.seconds = "00";
                            _this.stopTimer();
                        }
                        obs.next(_this.timerValue);
                        obs.complete();
                    }
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    obs.error(error);
                    obs.complete();
                }));
            }));
        });
        //set timer value
        this.setTimervalue = (/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            /** @type {?} */
            var valString = val + "";
            return (valString.length < 2) ? "0" + valString : valString;
        });
        this.interval = interval(1000);
    }
    CountdownTimerService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    CountdownTimerService.ctorParameters = function () { return []; };
    /** @nocollapse */ CountdownTimerService.ngInjectableDef = i0.defineInjectable({ factory: function CountdownTimerService_Factory() { return new CountdownTimerService(); }, token: CountdownTimerService, providedIn: "root" });
    return CountdownTimerService;
}());
export { CountdownTimerService };
if (false) {
    /** @type {?} */
    CountdownTimerService.prototype.onTimerStatusChange;
    /** @type {?} */
    CountdownTimerService.prototype.timerValue;
    /** @type {?} */
    CountdownTimerService.prototype.isTimerStart;
    /** @type {?} */
    CountdownTimerService.prototype.interval;
    /** @type {?} */
    CountdownTimerService.prototype.intervalSubscription;
    /** @type {?} */
    CountdownTimerService.prototype.totalSeconds;
    /** @type {?} */
    CountdownTimerService.prototype.currentOperationId;
    /** @type {?} */
    CountdownTimerService.prototype.startTimer;
    /** @type {?} */
    CountdownTimerService.prototype.pauseTimer;
    /** @type {?} */
    CountdownTimerService.prototype.stopTimer;
    /** @type {?} */
    CountdownTimerService.prototype.resumeTimer;
    /** @type {?} */
    CountdownTimerService.prototype.getTimerValue;
    /** @type {?} */
    CountdownTimerService.prototype.setTimervalue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291bnRkb3duLXRpbWVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtdGltZXIvIiwic291cmNlcyI6WyJsaWIvY291bnRkb3duLXRpbWVyL2NvdW50ZG93bi10aW1lci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0seUJBQXlCLENBQUM7O0FBRXJEO0lBa0JFO1FBQUEsaUJBRUM7UUFmTSx3QkFBbUIsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7UUFHakUsZUFBVSxHQUFHO1lBQ2xCLE9BQU8sRUFBRSxJQUFJO1lBQ2IsSUFBSSxFQUFFLElBQUk7WUFDVixLQUFLLEVBQUUsSUFBSTtTQUNaLENBQUE7UUFDTSxpQkFBWSxHQUFZLEtBQUssQ0FBQztRQUc5QixpQkFBWSxHQUFXLENBQUMsQ0FBQztRQUN6Qix1QkFBa0IsR0FBVyxDQUFDLENBQUM7O1FBTXRDLGVBQVU7Ozs7UUFBRyxVQUFDLFNBQWM7WUFDMUIsSUFBSSxTQUFTLEVBQUU7O29CQUNULFdBQVcsR0FBRyxJQUFJLElBQUksRUFBRTs7b0JBQ3hCLFdBQVcsR0FBRyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQ3JDLEtBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxHQUFHLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7YUFDL0Y7WUFDRCxLQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztZQUN6QixLQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFVBQVUs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RyxHQUFHLEdBQUcsRUFBRTtZQUN4QixPQUFPLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1FBQzlELENBQUMsRUFBQTtRQWxGQyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqQyxDQUFDOztnQkFwQkYsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7Ozs7Z0NBTkQ7Q0EwR0MsQUF0R0QsSUFzR0M7U0FuR1kscUJBQXFCOzs7SUFFaEMsb0RBQXdFOztJQUd4RSwyQ0FJQzs7SUFDRCw2Q0FBcUM7O0lBQ3JDLHlDQUFpQzs7SUFDakMscURBQTRCOztJQUM1Qiw2Q0FBZ0M7O0lBQ2hDLG1EQUFzQzs7SUFNdEMsMkNBU0M7O0lBR0QsMkNBU0M7O0lBR0QsMENBSUM7O0lBR0QsNENBRUM7O0lBR0QsOENBb0NDOztJQUdELDhDQUdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIGludGVydmFsIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFRpbWVyU3RhdXMgfSBmcm9tICcuL2NvdW50ZG93bi10aW1lci5tb2RlbCc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb3VudGRvd25UaW1lclNlcnZpY2Uge1xyXG5cclxuICBwdWJsaWMgb25UaW1lclN0YXR1c0NoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLy9Jbml0XHJcbiAgcHVibGljIHRpbWVyVmFsdWUgPSB7XHJcbiAgICBzZWNvbmRzOiAnMDAnLFxyXG4gICAgbWluczogJzAwJyxcclxuICAgIGhvdXJzOiAnMDAnLFxyXG4gIH1cclxuICBwdWJsaWMgaXNUaW1lclN0YXJ0OiBib29sZWFuID0gZmFsc2U7XHJcbiAgcHVibGljIGludGVydmFsOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgcHVibGljIGludGVydmFsU3Vic2NyaXB0aW9uO1xyXG4gIHB1YmxpYyB0b3RhbFNlY29uZHM6IG51bWJlciA9IDA7XHJcbiAgcHVibGljIGN1cnJlbnRPcGVyYXRpb25JZDogbnVtYmVyID0gMDtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuaW50ZXJ2YWwgPSBpbnRlcnZhbCgxMDAwKTtcclxuICB9XHJcblxyXG4gIC8vc3RhcnQgdGltZXJcclxuICBzdGFydFRpbWVyID0gKHN0YXJ0VGltZTogYW55KSA9PiB7XHJcbiAgICBpZiAoc3RhcnRUaW1lKSB7XHJcbiAgICAgIGxldCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIGxldCBzdGFydGVkVGltZSA9IG5ldyBEYXRlKHN0YXJ0VGltZSk7XHJcbiAgICAgIHRoaXMudG90YWxTZWNvbmRzID0gKE1hdGgucm91bmQoKGN1cnJlbnREYXRlLmdldFRpbWUoKSAtIHN0YXJ0ZWRUaW1lLmdldFRpbWUoKSkgLyAxMDAwKSkgKiAtMTtcclxuICAgIH1cclxuICAgIHRoaXMuaXNUaW1lclN0YXJ0ID0gdHJ1ZTtcclxuICAgIHRoaXMub25UaW1lclN0YXR1c0NoYW5nZS5lbWl0KFRpbWVyU3RhdXMuU1RBUlQpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvL2VuZCB0aW1lclxyXG4gIHBhdXNlVGltZXIgPSAoc3RhcnRUaW1lPzogYW55LCBlbmRUaW1lPzogYW55KSA9PiB7XHJcbiAgICBpZiAoc3RhcnRUaW1lICYmIGVuZFRpbWUpIHtcclxuICAgICAgbGV0IGVuZGVkRGF0ZSA9IG5ldyBEYXRlKGVuZFRpbWUpO1xyXG4gICAgICBsZXQgc3RhcnRlZFRpbWUgPSBuZXcgRGF0ZShzdGFydFRpbWUpO1xyXG4gICAgICB0aGlzLnRvdGFsU2Vjb25kcyA9IE1hdGgucm91bmQoKGVuZGVkRGF0ZS5nZXRUaW1lKCkgLSBzdGFydGVkVGltZS5nZXRUaW1lKCkpIC8gMTAwMCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmlzVGltZXJTdGFydCA9IGZhbHNlO1xyXG4gICAgdGhpcy5vblRpbWVyU3RhdHVzQ2hhbmdlLmVtaXQoVGltZXJTdGF1cy5QQVVTRSk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvL3Jlc2V0IFRpbWVyXHJcbiAgc3RvcFRpbWVyID0gKCkgPT4ge1xyXG4gICAgdGhpcy5pc1RpbWVyU3RhcnQgPSBmYWxzZTtcclxuICAgIHRoaXMudG90YWxTZWNvbmRzID0gMDtcclxuICAgIHRoaXMub25UaW1lclN0YXR1c0NoYW5nZS5lbWl0KFRpbWVyU3RhdXMuU1RPUCk7XHJcbiAgfVxyXG5cclxuICAvL3Jlc3VtZSBUaW1lclxyXG4gIHJlc3VtZVRpbWVyID0gKCkgPT4ge1xyXG4gICAgdGhpcy5pc1RpbWVyU3RhcnQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLy9nZXQgdGltZXIgdmFsdWUgT2JqXHJcbiAgZ2V0VGltZXJWYWx1ZSA9ICgpOiBPYnNlcnZhYmxlPGFueT4gPT4ge1xyXG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9icyA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmludGVydmFsU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnZhbFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuaW50ZXJ2YWxTdWJzY3JpcHRpb24gPSB0aGlzLmludGVydmFsLnN1YnNjcmliZShpbnQgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmlzVGltZXJTdGFydCAmJiB0aGlzLnRvdGFsU2Vjb25kcyA+IDApIHtcclxuICAgICAgICAgIC0tdGhpcy50b3RhbFNlY29uZHM7XHJcbiAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUuc2Vjb25kcyA9IHRoaXMuc2V0VGltZXJ2YWx1ZSh0aGlzLnRvdGFsU2Vjb25kcyAlIDYwKTtcclxuICAgICAgICAgIGxldCB0b3RhbFNlY29uZHNGb3JNaW51dGVzID0gMDtcclxuICAgICAgICAgIHRvdGFsU2Vjb25kc0Zvck1pbnV0ZXMgPSAoTWF0aC50cnVuYyh0aGlzLnRvdGFsU2Vjb25kcyAvIDYwKSA+PSA2MCkgPyAodGhpcy50b3RhbFNlY29uZHMgLyA2MCkgJSA2MCA6IHRoaXMudG90YWxTZWNvbmRzIC8gNjA7XHJcbiAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUubWlucyA9IHRoaXMuc2V0VGltZXJ2YWx1ZShNYXRoLnRydW5jKHRvdGFsU2Vjb25kc0Zvck1pbnV0ZXMpKTtcclxuICAgICAgICAgIHRoaXMudGltZXJWYWx1ZS5ob3VycyA9IHRoaXMuc2V0VGltZXJ2YWx1ZShNYXRoLnRydW5jKHRoaXMudG90YWxTZWNvbmRzIC8gMzYwMCkpO1xyXG4gICAgICAgICAgb2JzLm5leHQodGhpcy50aW1lclZhbHVlKTtcclxuICAgICAgICAgIG9icy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAodGhpcy50b3RhbFNlY29uZHMgPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJWYWx1ZS5zZWNvbmRzID0gdGhpcy5zZXRUaW1lcnZhbHVlKHRoaXMudG90YWxTZWNvbmRzICUgNjApO1xyXG4gICAgICAgICAgICBsZXQgdG90YWxTZWNvbmRzRm9yTWludXRlcyA9IDA7XHJcbiAgICAgICAgICAgIHRvdGFsU2Vjb25kc0Zvck1pbnV0ZXMgPSAoTWF0aC50cnVuYyh0aGlzLnRvdGFsU2Vjb25kcyAvIDYwKSA+PSA2MCkgPyAodGhpcy50b3RhbFNlY29uZHMgLyA2MCkgJSA2MCA6IHRoaXMudG90YWxTZWNvbmRzIC8gNjA7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJWYWx1ZS5taW5zID0gdGhpcy5zZXRUaW1lcnZhbHVlKE1hdGgudHJ1bmModG90YWxTZWNvbmRzRm9yTWludXRlcykpO1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUuaG91cnMgPSB0aGlzLnNldFRpbWVydmFsdWUoTWF0aC50cnVuYyh0aGlzLnRvdGFsU2Vjb25kcyAvIDM2MDApKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJWYWx1ZS5ob3VycyA9IFwiMDBcIjtcclxuICAgICAgICAgICAgdGhpcy50aW1lclZhbHVlLm1pbnMgPSBcIjAwXCI7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJWYWx1ZS5zZWNvbmRzID0gXCIwMFwiO1xyXG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lcigpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgb2JzLm5leHQodGhpcy50aW1lclZhbHVlKTtcclxuICAgICAgICAgIG9icy5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgIG9icy5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgb2JzLmNvbXBsZXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL3NldCB0aW1lciB2YWx1ZVxyXG4gIHNldFRpbWVydmFsdWUgPSAodmFsKSA9PiB7XHJcbiAgICBsZXQgdmFsU3RyaW5nID0gdmFsICsgXCJcIjtcclxuICAgIHJldHVybiAodmFsU3RyaW5nLmxlbmd0aCA8IDIpID8gXCIwXCIgKyB2YWxTdHJpbmcgOiB2YWxTdHJpbmc7XHJcbiAgfVxyXG59XHJcblxyXG4iXX0=
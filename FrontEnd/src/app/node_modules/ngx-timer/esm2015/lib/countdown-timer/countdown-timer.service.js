/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, EventEmitter } from '@angular/core';
import { Observable, interval } from 'rxjs';
import { TimerStaus } from './countdown-timer.model';
import * as i0 from "@angular/core";
export class CountdownTimerService {
    constructor() {
        this.onTimerStatusChange = new EventEmitter();
        //Init
        this.timerValue = {
            seconds: '00',
            mins: '00',
            hours: '00',
        };
        this.isTimerStart = false;
        this.totalSeconds = 0;
        this.currentOperationId = 0;
        //start timer
        this.startTimer = (/**
         * @param {?} startTime
         * @return {?}
         */
        (startTime) => {
            if (startTime) {
                /** @type {?} */
                let currentDate = new Date();
                /** @type {?} */
                let startedTime = new Date(startTime);
                this.totalSeconds = (Math.round((currentDate.getTime() - startedTime.getTime()) / 1000)) * -1;
            }
            this.isTimerStart = true;
            this.onTimerStatusChange.emit(TimerStaus.START);
            return true;
        });
        //end timer
        this.pauseTimer = (/**
         * @param {?=} startTime
         * @param {?=} endTime
         * @return {?}
         */
        (startTime, endTime) => {
            if (startTime && endTime) {
                /** @type {?} */
                let endedDate = new Date(endTime);
                /** @type {?} */
                let startedTime = new Date(startTime);
                this.totalSeconds = Math.round((endedDate.getTime() - startedTime.getTime()) / 1000);
            }
            this.isTimerStart = false;
            this.onTimerStatusChange.emit(TimerStaus.PAUSE);
            return false;
        });
        //reset Timer
        this.stopTimer = (/**
         * @return {?}
         */
        () => {
            this.isTimerStart = false;
            this.totalSeconds = 0;
            this.onTimerStatusChange.emit(TimerStaus.STOP);
        });
        //resume Timer
        this.resumeTimer = (/**
         * @return {?}
         */
        () => {
            this.isTimerStart = true;
        });
        //get timer value Obj
        this.getTimerValue = (/**
         * @return {?}
         */
        () => {
            return new Observable((/**
             * @param {?} obs
             * @return {?}
             */
            obs => {
                if (this.intervalSubscription) {
                    this.intervalSubscription.unsubscribe();
                }
                this.intervalSubscription = this.interval.subscribe((/**
                 * @param {?} int
                 * @return {?}
                 */
                int => {
                    if (this.isTimerStart && this.totalSeconds > 0) {
                        --this.totalSeconds;
                        this.timerValue.seconds = this.setTimervalue(this.totalSeconds % 60);
                        /** @type {?} */
                        let totalSecondsForMinutes = 0;
                        totalSecondsForMinutes = (Math.trunc(this.totalSeconds / 60) >= 60) ? (this.totalSeconds / 60) % 60 : this.totalSeconds / 60;
                        this.timerValue.mins = this.setTimervalue(Math.trunc(totalSecondsForMinutes));
                        this.timerValue.hours = this.setTimervalue(Math.trunc(this.totalSeconds / 3600));
                        obs.next(this.timerValue);
                        obs.complete();
                    }
                    else {
                        if (this.totalSeconds > 0) {
                            this.timerValue.seconds = this.setTimervalue(this.totalSeconds % 60);
                            /** @type {?} */
                            let totalSecondsForMinutes = 0;
                            totalSecondsForMinutes = (Math.trunc(this.totalSeconds / 60) >= 60) ? (this.totalSeconds / 60) % 60 : this.totalSeconds / 60;
                            this.timerValue.mins = this.setTimervalue(Math.trunc(totalSecondsForMinutes));
                            this.timerValue.hours = this.setTimervalue(Math.trunc(this.totalSeconds / 3600));
                        }
                        else {
                            this.timerValue.hours = "00";
                            this.timerValue.mins = "00";
                            this.timerValue.seconds = "00";
                            this.stopTimer();
                        }
                        obs.next(this.timerValue);
                        obs.complete();
                    }
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    obs.error(error);
                    obs.complete();
                }));
            }));
        });
        //set timer value
        this.setTimervalue = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            /** @type {?} */
            let valString = val + "";
            return (valString.length < 2) ? "0" + valString : valString;
        });
        this.interval = interval(1000);
    }
}
CountdownTimerService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
CountdownTimerService.ctorParameters = () => [];
/** @nocollapse */ CountdownTimerService.ngInjectableDef = i0.defineInjectable({ factory: function CountdownTimerService_Factory() { return new CountdownTimerService(); }, token: CountdownTimerService, providedIn: "root" });
if (false) {
    /** @type {?} */
    CountdownTimerService.prototype.onTimerStatusChange;
    /** @type {?} */
    CountdownTimerService.prototype.timerValue;
    /** @type {?} */
    CountdownTimerService.prototype.isTimerStart;
    /** @type {?} */
    CountdownTimerService.prototype.interval;
    /** @type {?} */
    CountdownTimerService.prototype.intervalSubscription;
    /** @type {?} */
    CountdownTimerService.prototype.totalSeconds;
    /** @type {?} */
    CountdownTimerService.prototype.currentOperationId;
    /** @type {?} */
    CountdownTimerService.prototype.startTimer;
    /** @type {?} */
    CountdownTimerService.prototype.pauseTimer;
    /** @type {?} */
    CountdownTimerService.prototype.stopTimer;
    /** @type {?} */
    CountdownTimerService.prototype.resumeTimer;
    /** @type {?} */
    CountdownTimerService.prototype.getTimerValue;
    /** @type {?} */
    CountdownTimerService.prototype.setTimervalue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291bnRkb3duLXRpbWVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtdGltZXIvIiwic291cmNlcyI6WyJsaWIvY291bnRkb3duLXRpbWVyL2NvdW50ZG93bi10aW1lci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0seUJBQXlCLENBQUM7O0FBS3JELE1BQU0sT0FBTyxxQkFBcUI7SUFlaEM7UUFiTyx3QkFBbUIsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7UUFHakUsZUFBVSxHQUFHO1lBQ2xCLE9BQU8sRUFBRSxJQUFJO1lBQ2IsSUFBSSxFQUFFLElBQUk7WUFDVixLQUFLLEVBQUUsSUFBSTtTQUNaLENBQUE7UUFDTSxpQkFBWSxHQUFZLEtBQUssQ0FBQztRQUc5QixpQkFBWSxHQUFXLENBQUMsQ0FBQztRQUN6Qix1QkFBa0IsR0FBVyxDQUFDLENBQUM7O1FBTXRDLGVBQVU7Ozs7UUFBRyxDQUFDLFNBQWMsRUFBRSxFQUFFO1lBQzlCLElBQUksU0FBUyxFQUFFOztvQkFDVCxXQUFXLEdBQUcsSUFBSSxJQUFJLEVBQUU7O29CQUN4QixXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO2dCQUNyQyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2FBQy9GO1lBQ0QsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDekIsSUFBSSxDQUFDLG1CQUFtQixDQUFD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QUFDLEVBQUMsQ0FBQztRQUNMLENBQUMsRUFBQTs7UUFHRCxrQkFBYTs7OztRQUFHLENBQUMsR0FBRyxFQUFFLEVBQUU7O2dCQUNsQixTQUFTLEdBQUcsR0FBRyxHQUFHLEVBQUU7WUFDeEIsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUM5RCxDQUFDLEVBQUE7UUFsRkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakMsQ0FBQzs7O1lBcEJGLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7Ozs7OztJQUdDLG9EQUF3RTs7SUFHeEUsMkNBSUM7O0lBQ0QsNkNBQXFDOztJQUNyQyx5Q0FBaUM7O0lBQ2pDLHFEQUE0Qjs7SUFDNUIsNkNBQWdDOztJQUNoQyxtREFBc0M7O0lBTXRDLDJDQVNDOztJQUdELDJDQVNDOztJQUdELDBDQUlDOztJQUdELDRDQUVDOztJQUdELDhDQW9DQzs7SUFHRCw4Q0FHQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBpbnRlcnZhbCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBUaW1lclN0YXVzIH0gZnJvbSAnLi9jb3VudGRvd24tdGltZXIubW9kZWwnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQ291bnRkb3duVGltZXJTZXJ2aWNlIHtcclxuXHJcbiAgcHVibGljIG9uVGltZXJTdGF0dXNDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8vSW5pdFxyXG4gIHB1YmxpYyB0aW1lclZhbHVlID0ge1xyXG4gICAgc2Vjb25kczogJzAwJyxcclxuICAgIG1pbnM6ICcwMCcsXHJcbiAgICBob3VyczogJzAwJyxcclxuICB9XHJcbiAgcHVibGljIGlzVGltZXJTdGFydDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHB1YmxpYyBpbnRlcnZhbDogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIHB1YmxpYyBpbnRlcnZhbFN1YnNjcmlwdGlvbjtcclxuICBwdWJsaWMgdG90YWxTZWNvbmRzOiBudW1iZXIgPSAwO1xyXG4gIHB1YmxpYyBjdXJyZW50T3BlcmF0aW9uSWQ6IG51bWJlciA9IDA7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmludGVydmFsID0gaW50ZXJ2YWwoMTAwMCk7XHJcbiAgfVxyXG5cclxuICAvL3N0YXJ0IHRpbWVyXHJcbiAgc3RhcnRUaW1lciA9IChzdGFydFRpbWU6IGFueSkgPT4ge1xyXG4gICAgaWYgKHN0YXJ0VGltZSkge1xyXG4gICAgICBsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICBsZXQgc3RhcnRlZFRpbWUgPSBuZXcgRGF0ZShzdGFydFRpbWUpO1xyXG4gICAgICB0aGlzLnRvdGFsU2Vjb25kcyA9IChNYXRoLnJvdW5kKChjdXJyZW50RGF0ZS5nZXRUaW1lKCkgLSBzdGFydGVkVGltZS5nZXRUaW1lKCkpIC8gMTAwMCkpICogLTE7XHJcbiAgICB9XHJcbiAgICB0aGlzLmlzVGltZXJTdGFydCA9IHRydWU7XHJcbiAgICB0aGlzLm9uVGltZXJTdGF0dXNDaGFuZ2UuZW1pdChUaW1lclN0YXVzLlNUQVJUKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLy9lbmQgdGltZXJcclxuICBwYXVzZVRpbWVyID0gKHN0YXJ0VGltZT86IGFueSwgZW5kVGltZT86IGFueSkgPT4ge1xyXG4gICAgaWYgKHN0YXJ0VGltZSAmJiBlbmRUaW1lKSB7XHJcbiAgICAgIGxldCBlbmRlZERhdGUgPSBuZXcgRGF0ZShlbmRUaW1lKTtcclxuICAgICAgbGV0IHN0YXJ0ZWRUaW1lID0gbmV3IERhdGUoc3RhcnRUaW1lKTtcclxuICAgICAgdGhpcy50b3RhbFNlY29uZHMgPSBNYXRoLnJvdW5kKChlbmRlZERhdGUuZ2V0VGltZSgpIC0gc3RhcnRlZFRpbWUuZ2V0VGltZSgpKSAvIDEwMDApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pc1RpbWVyU3RhcnQgPSBmYWxzZTtcclxuICAgIHRoaXMub25UaW1lclN0YXR1c0NoYW5nZS5lbWl0KFRpbWVyU3RhdXMuUEFVU0UpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLy9yZXNldCBUaW1lclxyXG4gIHN0b3BUaW1lciA9ICgpID0+IHtcclxuICAgIHRoaXMuaXNUaW1lclN0YXJ0ID0gZmFsc2U7XHJcbiAgICB0aGlzLnRvdGFsU2Vjb25kcyA9IDA7XHJcbiAgICB0aGlzLm9uVGltZXJTdGF0dXNDaGFuZ2UuZW1pdChUaW1lclN0YXVzLlNUT1ApO1xyXG4gIH1cclxuXHJcbiAgLy9yZXN1bWUgVGltZXJcclxuICByZXN1bWVUaW1lciA9ICgpID0+IHtcclxuICAgIHRoaXMuaXNUaW1lclN0YXJ0ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8vZ2V0IHRpbWVyIHZhbHVlIE9ialxyXG4gIGdldFRpbWVyVmFsdWUgPSAoKTogT2JzZXJ2YWJsZTxhbnk+ID0+IHtcclxuICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnMgPT4ge1xyXG4gICAgICBpZiAodGhpcy5pbnRlcnZhbFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgIHRoaXMuaW50ZXJ2YWxTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmludGVydmFsU3Vic2NyaXB0aW9uID0gdGhpcy5pbnRlcnZhbC5zdWJzY3JpYmUoaW50ID0+IHtcclxuICAgICAgICBpZiAodGhpcy5pc1RpbWVyU3RhcnQgJiYgdGhpcy50b3RhbFNlY29uZHMgPiAwKSB7XHJcbiAgICAgICAgICAtLXRoaXMudG90YWxTZWNvbmRzO1xyXG4gICAgICAgICAgdGhpcy50aW1lclZhbHVlLnNlY29uZHMgPSB0aGlzLnNldFRpbWVydmFsdWUodGhpcy50b3RhbFNlY29uZHMgJSA2MCk7XHJcbiAgICAgICAgICBsZXQgdG90YWxTZWNvbmRzRm9yTWludXRlcyA9IDA7XHJcbiAgICAgICAgICB0b3RhbFNlY29uZHNGb3JNaW51dGVzID0gKE1hdGgudHJ1bmModGhpcy50b3RhbFNlY29uZHMgLyA2MCkgPj0gNjApID8gKHRoaXMudG90YWxTZWNvbmRzIC8gNjApICUgNjAgOiB0aGlzLnRvdGFsU2Vjb25kcyAvIDYwO1xyXG4gICAgICAgICAgdGhpcy50aW1lclZhbHVlLm1pbnMgPSB0aGlzLnNldFRpbWVydmFsdWUoTWF0aC50cnVuYyh0b3RhbFNlY29uZHNGb3JNaW51dGVzKSk7XHJcbiAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUuaG91cnMgPSB0aGlzLnNldFRpbWVydmFsdWUoTWF0aC50cnVuYyh0aGlzLnRvdGFsU2Vjb25kcyAvIDM2MDApKTtcclxuICAgICAgICAgIG9icy5uZXh0KHRoaXMudGltZXJWYWx1ZSk7XHJcbiAgICAgICAgICBvYnMuY29tcGxldGUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaWYgKHRoaXMudG90YWxTZWNvbmRzID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUuc2Vjb25kcyA9IHRoaXMuc2V0VGltZXJ2YWx1ZSh0aGlzLnRvdGFsU2Vjb25kcyAlIDYwKTtcclxuICAgICAgICAgICAgbGV0IHRvdGFsU2Vjb25kc0Zvck1pbnV0ZXMgPSAwO1xyXG4gICAgICAgICAgICB0b3RhbFNlY29uZHNGb3JNaW51dGVzID0gKE1hdGgudHJ1bmModGhpcy50b3RhbFNlY29uZHMgLyA2MCkgPj0gNjApID8gKHRoaXMudG90YWxTZWNvbmRzIC8gNjApICUgNjAgOiB0aGlzLnRvdGFsU2Vjb25kcyAvIDYwO1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUubWlucyA9IHRoaXMuc2V0VGltZXJ2YWx1ZShNYXRoLnRydW5jKHRvdGFsU2Vjb25kc0Zvck1pbnV0ZXMpKTtcclxuICAgICAgICAgICAgdGhpcy50aW1lclZhbHVlLmhvdXJzID0gdGhpcy5zZXRUaW1lcnZhbHVlKE1hdGgudHJ1bmModGhpcy50b3RhbFNlY29uZHMgLyAzNjAwKSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUuaG91cnMgPSBcIjAwXCI7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJWYWx1ZS5taW5zID0gXCIwMFwiO1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVyVmFsdWUuc2Vjb25kcyA9IFwiMDBcIjtcclxuICAgICAgICAgICAgdGhpcy5zdG9wVGltZXIoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIG9icy5uZXh0KHRoaXMudGltZXJWYWx1ZSk7XHJcbiAgICAgICAgICBvYnMuY29tcGxldGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICBvYnMuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIG9icy5jb21wbGV0ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy9zZXQgdGltZXIgdmFsdWVcclxuICBzZXRUaW1lcnZhbHVlID0gKHZhbCkgPT4ge1xyXG4gICAgbGV0IHZhbFN0cmluZyA9IHZhbCArIFwiXCI7XHJcbiAgICByZXR1cm4gKHZhbFN0cmluZy5sZW5ndGggPCAyKSA/IFwiMFwiICsgdmFsU3RyaW5nIDogdmFsU3RyaW5nO1xyXG4gIH1cclxufVxyXG5cclxuIl19